<!-- (c) Copyright 2010 Andrew Okonetchnikov (http://okonet.ru, andrej.okonetschnikow@gmail.com). All Rights Reserved.  -->
<!DOCTYPE html>
<html lang="en">
<head>
  <style type="text/css" media="screen">
    html,body {
      font: 13px "Helvetica Neue",Arial,sans-serif;
      width: 220px;
    }
  </style>
  <script type="text/javascript" charset="utf-8">

    function $(id) {
      return document.getElementById(id);
    }

    // Opens tab with slovari.yandex.ru translation for a given term within the given language
    function openTabWithTranslation(term, lang) {
      var lang = lang || 'en'; // Use english as a dafault language
      chrome.tabs.create({
        'url': 'http://lingvo.yandex.ru/' + lang + '?st_translate=on&text=' + term
      });
    }
  
    function initPopup() {
      // Determine language of the active tab
      chrome.tabs.detectLanguage(null, function(lang){
        // Get term from extension background page
        var term = chrome.extension.getBackgroundPage().selection;
      
        if(typeof term == "string" && term.length > 0) {
          $('content').innerHTML = "";
          openTabWithTranslation(term, lang);
        } else {
          $('text').focus();
        }
      });
    }
  </script>
</head>
<body onload="initPopup();">
  <form action="http://lingvo.yandex.ru/en/" id="content" onsubmit="openTabWithTranslation($('text').value); return false;">
    <label for="text">Enter a word:</label><br>
    <input type="input" name="text" value="" id="text" placeholder="Enter the word to translate">
    <input type="submit" id="submit" value="Translate!">
  </form>
</body>
</html>